<?xml version="1.0" encoding="UTF-8"?>
<config xmlns:xi="http://www.w3.org/2001/XInclude">
  <!-- Sources -->
  <sources ignoredDirs="CVS:.svn">
		<sourceset>
    	<source name="drupal" scanPath="/htdocs/drupal" documentRoot="/htdocs" basePath="/drupal/" />
    	<source name="downloads" scanPath="/Users/wimleers/Downloads" />
		</sourceset>
		
		<!-- Source sets can also be stored in separate files and included as follows: -->
		<xi:include href="sources.sample.xml" parse="xml" />
  </sources>

  <!-- Servers -->
  <servers>
		<serverset>
	    <server name="origin pull cdn" transporter="symlink_or_copy">
	      <location>/htdocs/static.example.com</location>
	      <url>http://localhost/static.example.com/</url>
	    </server>
			<server name="ftp push cdn" transporter="ftp" maxConnections="5">
	      <host>localhost</host>
	      <username>daemontest</username>
	      <password>daemontest</password>
	      <url>http://localhost/daemontest/</url>
	    </server>
		</serverset>
		
		<!-- Server sets can also be stored in separate files and included as follows: -->
		<xi:include href="servers.sample.xml" parse="xml" />
  </servers>

  <!-- Rules -->
  <rules>
		<ruleset>
	    <rule for="drupal" label="CSS, JS, images and Flash">
	      <filter>
	        <paths>misc:profiles:modules:themes:sites/all:sites/default</paths>
	        <extensions>ico:js:css:gif:png:jpg:jpeg:svg:swf</extensions>
	      </filter>
	      <processorChain>
	        <processor name="image_optimizer.KeepFilename" />
	        <processor name="yui_compressor.YUICompressor" />
	        <processor name="google_closure_compiler.GoogleClosureCompiler" />
	        <processor name="link_updater.CSSURLUpdater" />
	        <processor name="unique_filename.Mtime" />
	      </processorChain>
	      <destinations>
	        <destination server="origin pull cdn" path="static" />
	        <destination server="ftp push cdn" path="static" />
	      </destinations>
	    </rule>

	    <!-- Automatically delete videos from the source, 60 seconds after they
	         have been synced, because they consume so much disk space. -->
	    <rule for="drupal" label="Videos" fileDeletionDelayAfterSync="60">
	      <filter>
	        <paths>modules:misc</paths>
	        <extensions>flv:mov:avi:wmv</extensions>
	        <size conditionType="minimum">1000000</size>
	      </filter>
	      <processorChain>
	        <processor name="unique_filename.MD5" />
	      </processorChain>
	      <destinations>
	        <destination server="ftp push cdn" path="videos" />
	      </destinations>
	    </rule>
			
	    <rule for="downloads" label="Mirror 720P videos">
	      <filter>
	        <extensions>mov:avi:mkv</extensions>
	        <pattern>.*/([a-zA-Z\-_ ])+720([a-zA-Z\-_ ])*\.[a-zA-Z]{3}$</pattern>
	      </filter>
	      <destinations>
	        <destination server="origin pull cdn" path="mirror" />
	        <destination server="ftp push cdn" path="mirror" />
	      </destinations>
	    </rule>
		</ruleset>
		
		<!-- Rule sets can also be stored in separate files and included as follows: -->
		<xi:include href="rules.sample.xml" parse="xml" />
  </rules>
</config>
